/*infobox http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/docs/reference.html#InfoBox */
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('6 p(a){a=a||{};7.9.1L.2e(2,2Z);2.I=a.1t||"";2.1C=a.1m||D;2.O=a.1E||0;2.F=a.1y||19 7.9.1Q(0,0);2.C=a.Q||19 7.9.2p(0,0);2.U=a.R||r;2.1l=a.1k||"26";2.1i=a.z||{};2.1D=a.1B||"31";2.M=a.1f||"2R://2M.7.2J/2F/2E/2C/1w.2x";3(a.1f===""){2.M=""}2.1g=a.1q||19 7.9.1Q(1,1);2.12=a.1o||D;2.1n=a.2l||D;2.1H=a.2h||"2d";2.17=a.1j||D;2.4=r;2.w=r;2.N=r;2.1h=r;2.15=r;2.14=r;2.13=r;2.L=r}p.q=19 7.9.1L();p.q.20=6(){5 a;5 d=2;5 c=6(e){e.1Y=11;3(e.1e){e.1e()}};5 b=6(e){e.2P=D;3(e.1W){e.1W()}3(!d.17){c(e)}};3(!2.4){2.4=1d.2I("2H");2.1a();3(u 2.I.1R==="t"){2.4.X=2.H()+2.I}v{2.4.X=2.H();2.4.1r(2.I)}2.2w()[2.1H].1r(2.4);2.1z();3(2.4.8.A){2.L=11}v{3(2.O!==0&&2.4.Y>2.O){2.4.8.A=2.O;2.4.8.2q="2o";2.L=11}v{a=2.1J();2.4.8.A=(2.4.Y-a.W-a.V)+"T";2.L=D}}2.1p(2.1C);3(!2.17){2.N=7.9.s.S(2.4,"2m",c);2.1h=7.9.s.S(2.4,"1I",c);2.15=7.9.s.S(2.4,"2k",c)}2.13=7.9.s.S(2.4,"2j",b);7.9.s.P(2,"2i")}};p.q.H=6(){5 a="";3(2.M!==""){a="<2g";a+=" 2f=\'"+2.M+"\'";a+=" 2c=V";a+=" 8=\'";a+=" Q: 2b;";a+=" 2a: 29;";a+=" 28: "+2.1D+";";a+="\'>"}K a};p.q.1z=6(){5 a;3(2.M!==""){a=2.4.27;2.w=7.9.s.S(a,\'1I\',2.1G())}v{2.w=r}};p.q.1G=6(){5 a=2;K 6(e){e.1Y=11;3(e.1e){e.1e()}a.1w();7.9.s.P(a,"25")}};p.q.1p=6(d){5 m;5 n;5 e=0,G=0;3(!d){m=2.24();3(m 23 7.9.22){3(!m.1F().36(2.C)){m.35(2.C)}n=m.1F();5 a=m.34();5 h=a.Y;5 f=a.21;5 k=2.F.A;5 l=2.F.16;5 g=2.4.Y;5 b=2.4.21;5 i=2.1g.A;5 j=2.1g.16;5 o=2.1Z().30(2.C);3(o.x<(-k+i)){e=o.x+k-i}v 3((o.x+g+k+i)>h){e=o.x+g+k+i-h}3(2.1n){3(o.y<(-l+j+b)){G=o.y+l-j-b}v 3((o.y+l+j)>f){G=o.y+l+j-f}}v{3(o.y<(-l+j)){G=o.y+l-j}v 3((o.y+b+l+j)>f){G=o.y+b+l+j-f}}3(!(e===0&&G===0)){5 c=m.2Y();m.2X(e,G)}}}};p.q.1a=6(){5 i,z;3(2.4){2.4.2W=2.1l;2.4.8.2V="";z=2.1i;2U(i 2T z){3(z.2S(i)){2.4.8[i]=z[i]}}3(u 2.4.8.1c!=="t"&&2.4.8.1c!==""){2.4.8.2Q="2O(1c="+(2.4.8.1c*2N)+")"}2.4.8.Q="2K";2.4.8.Z=\'1v\';3(2.U!==r){2.4.8.R=2.U}}};p.q.1J=6(){5 c;5 a={18:0,1b:0,W:0,V:0};5 b=2.4;3(1d.1u&&1d.1u.1V){c=b.2G.1u.1V(b,"");3(c){a.18=B(c.1U,10)||0;a.1b=B(c.1T,10)||0;a.W=B(c.1P,10)||0;a.V=B(c.1S,10)||0}}v 3(1d.2D.J){3(b.J){a.18=B(b.J.1U,10)||0;a.1b=B(b.J.1T,10)||0;a.W=B(b.J.1P,10)||0;a.V=B(b.J.1S,10)||0}}K a};p.q.2B=6(){3(2.4){2.4.2L.2A(2.4);2.4=r}};p.q.1A=6(){2.20();5 a=2.1Z().2z(2.C);2.4.8.W=(a.x+2.F.A)+"T";3(2.1n){2.4.8.1b=-(a.y+2.F.16)+"T"}v{2.4.8.18=(a.y+2.F.16)+"T"}3(2.12){2.4.8.Z=\'1v\'}v{2.4.8.Z="1O"}};p.q.2y=6(a){3(u a.1k!=="t"){2.1l=a.1k;2.1a()}3(u a.z!=="t"){2.1i=a.z;2.1a()}3(u a.1t!=="t"){2.1N(a.1t)}3(u a.1m!=="t"){2.1C=a.1m}3(u a.1E!=="t"){2.O=a.1E}3(u a.1y!=="t"){2.F=a.1y}3(u a.Q!=="t"){2.1x(a.Q)}3(u a.R!=="t"){2.1X(a.R)}3(u a.1B!=="t"){2.1D=a.1B}3(u a.1f!=="t"){2.M=a.1f}3(u a.1q!=="t"){2.1g=a.1q}3(u a.1o!=="t"){2.12=a.1o}3(u a.1j!=="t"){2.17=a.1j}3(2.4){2.1A()}};p.q.1N=6(a){2.I=a;3(2.4){3(2.w){7.9.s.E(2.w);2.w=r}3(!2.L){2.4.8.A=""}3(u a.1R==="t"){2.4.X=2.H()+a}v{2.4.X=2.H();2.4.1r(a)}3(!2.L){2.4.8.A=2.4.Y+"T";2.4.X=2.H()+a}2.1z()}7.9.s.P(2,"2v")};p.q.1x=6(a){2.C=a;3(2.4){2.1A()}7.9.s.P(2,"1M")};p.q.1X=6(a){2.U=a;3(2.4){2.4.8.R=a}7.9.s.P(2,"2u")};p.q.2t=6(){K 2.I};p.q.1s=6(){K 2.C};p.q.2s=6(){K 2.U};p.q.2r=6(){2.12=D;3(2.4){2.4.8.Z="1O"}};p.q.32=6(){2.12=11;3(2.4){2.4.8.Z="1v"}};p.q.33=6(c,b){5 a=2;3(b){2.C=b.1s();2.14=7.9.s.2n(b,"1M",6(){a.1x(2.1s())})}2.1K(c);3(2.4){2.1p()}};p.q.1w=6(){3(2.w){7.9.s.E(2.w);2.w=r}3(2.N){7.9.s.E(2.N);7.9.s.E(2.1h);7.9.s.E(2.15);2.N=r;2.1h=r;2.15=r}3(2.14){7.9.s.E(2.14);2.14=r}3(2.13){7.9.s.E(2.13);2.13=r}2.1K(r)};',62,193,'||this|if|div_|var|function|google|style|maps||||||||||||||||InfoBox|prototype|null|event|undefined|typeof|else|closeListener_|||boxStyle|width|parseInt|position_|false|removeListener|pixelOffset_|yOffset|getCloseBoxImg_|content_|currentStyle|return|fixedWidthSet_|closeBoxURL_|eventListener1_|maxWidth_|trigger|position|zIndex|addDomListener|px|zIndex_|right|left|innerHTML|offsetWidth|visibility||true|isHidden_|contextListener_|moveListener_|eventListener3_|height|enableEventPropagation_|top|new|setBoxStyle_|bottom|opacity|document|stopPropagation|closeBoxURL|infoBoxClearance_|eventListener2_|boxStyle_|enableEventPropagation|boxClass|boxClass_|disableAutoPan|alignBottom_|isHidden|panBox_|infoBoxClearance|appendChild|getPosition|content|defaultView|hidden|close|setPosition|pixelOffset|addClickHandler_|draw|closeBoxMargin|disableAutoPan_|closeBoxMargin_|maxWidth|getBounds|getCloseClickHandler_|pane_|click|getBoxWidths_|setMap|OverlayView|position_changed|setContent|visible|borderLeftWidth|Size|nodeType|borderRightWidth|borderBottomWidth|borderTopWidth|getComputedStyle|preventDefault|setZIndex|cancelBubble|getProjection|createInfoBoxDiv_|offsetHeight|Map|instanceof|getMap|closeclick|infoBox|firstChild|margin|pointer|cursor|relative|align|floatPane|apply|src|img|pane|domready|contextmenu|dblclick|alignBottom|mousedown|addListener|auto|LatLng|overflow|show|getZIndex|getContent|zindex_changed|content_changed|getPanes|gif|setOptions|fromLatLngToDivPixel|removeChild|onRemove|mapfiles|documentElement|en_us|intl|ownerDocument|div|createElement|com|absolute|parentNode|www|100|alpha|returnValue|filter|http|hasOwnProperty|in|for|cssText|className|panBy|getCenter|arguments|fromLatLngToContainerPixel|2px|hide|open|getDiv|setCenter|contains'.split('|'),0,{}));


 
(function($){
	var FORMALIZE=(function(b,e,f,a){var h="placeholder" in f.createElement("input");var i="autofocus" in f.createElement("input");var g="webkitAppearance" in f.createElement("select").style;var d=!!(b.browser.msie&&parseInt(b.browser.version,10)===6);var c=!!(b.browser.msie&&parseInt(b.browser.version,10)===7);return{go:function(){for(var j in FORMALIZE.init){FORMALIZE.init[j]();}},init:{detect_webkit:function(){if(!g){return;}b("html").addClass("is_webkit");},full_input_size:function(){if(!c||!b("textarea, input.input_full").length){return;}b("textarea, input.input_full").wrap('<span class="input_full_wrap"></span>');},ie6_skin_inputs:function(){if(!d||!b("input, select, textarea").length){return;}var j=/button|submit|reset/;var k=/date|datetime|datetime-local|email|month|number|password|range|search|tel|text|time|url|week/;b("input").each(function(){var l=b(this);if(this.getAttribute("type").match(j)){l.addClass("ie6_button");if(this.disabled){l.addClass("ie6_button_disabled");}}else{if(this.getAttribute("type").match(k)){l.addClass("ie6_input");if(this.disabled){l.addClass("ie6_input_disabled");}}}});b("textarea, select").each(function(){if(this.disabled){b(this).addClass("ie6_input_disabled");}});},autofocus:function(){if(i||!b(":input[autofocus]").length){return;}b(":input[autofocus]:visible:first").focus();},placeholder:function(){if(h||!b(":input[placeholder]").length){return;}FORMALIZE.misc.add_placeholder();b(":input[placeholder]").each(function(){var j=b(this);var k=j.attr("placeholder");j.focus(function(){if(j.val()===k){j.val("").removeClass("placeholder_text");}}).blur(function(){FORMALIZE.misc.add_placeholder();});j.closest("form").submit(function(){if(j.val()===k){j.val("").removeClass("placeholder_text");}}).bind("reset",function(){setTimeout(FORMALIZE.misc.add_placeholder,50);});});}},misc:{add_placeholder:function(){if(h||!b(":input[placeholder]").length){return;}b(":input[placeholder]").each(function(){var j=b(this);var k=j.attr("placeholder");if(!j.val()||j.val()===k){j.val(k).addClass("placeholder_text");}});}}};})(jQuery,this,this.document);jQuery(document).ready(function(){FORMALIZE.go();});


	Raphael.fn.timeline = function(options){
		var paper = this,
			data = options.data,
			onClick = options.onClick,
			DAY =  1440*60*1000,
			HOUR = DAY/24,
			weekday = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

		function smallTab(x,y,text){
			var item = paper.set(),
				path = 'M'+~~(x-15)+','+y+'L'+~~(x)+','+y,
				attr = {stroke: 'white', 'stroke-width': '1px'}, 
				text = paper.text(x-20,y,text).attr({fill: '#ccc', font:'12px Helvetica', 'text-anchor': 'end', opacity: 0}),
				tab = paper.path(path).attr({stroke: 'white', 'stroke-width': '1px'});
			item.push(tab, text);
			item.mouseover(function(){
				text.animate({opacity: 1, x: x-25}, 200);
			}).mouseout(function(){
				text.animate({opacity: 0, x: x-20}, 500);
			});
			return item;
		}
		function mainTab(x,y,text){
			var item = paper.set(),
			 	path = 'M'+~~(x-30)+','+y+'L'+~~(x)+','+y,
				tab = paper.path(path).attr({stroke: '#ccc', 'stroke-width': '2px'}),
				text = paper.text(x-37,y,text).attr({fill: '#ccc', font:'12px Helvetica', 'text-anchor': 'end'});

			item.push(tab,text);

			item.hover(function(){
				text.animate({fill: '#eee'}, 200);
				tab.animate({stroke: '#eee'}, 200);
			},function(){
				text.animate({fill: '#ccc'}, 200);
				tab.animate({stroke: '#ccc'}, 200);
			});

			return item;
		}

		var timeFormated = {
			hour : function(time){
				var hour = new Date(time).getHours()+1, ampm = 'AM';

				if(hour == 12) return 'Noon';
				if(hour == 0) return 'Midnight';			
				if(hour > 12){ hour = hour-12; ampm = 'PM';}			

				return hour+':00 '+ampm;
			},
			day : function (time){
				return weekday[new Date(time).getDay()];
			},
			week : function(){},
			month : function(){}
		}

		function buildTimeline(data){
			var timeline = [], first = _.first(data), last = _.last(data), next = first.time*1, cycle, timeLength = last.time - first.time,
			getText = (timeLength/HOUR < 24) ? ((cycle = HOUR*2), timeFormated.hour) : 
					  (timeLength/DAY < 7) ? ((cycle = DAY), timeFormated.day) :
					  (timeLength/DAY < 30) ? ((cycle = DAY*7), timeFormated.week) :
					  ((cycle = DAY*30), timeFormated.month);

			_.each(data, function(unit){
				var obj = {time : unit.time*1, longitude: unit.longitude, latitude: unit.latitude};
				if(obj.time <= next){
					next = next-cycle;
					obj.text = getText(obj.time);
				}
				timeline.push(obj);
			});
			return timeline;
		}

		var timeline = buildTimeline(data),
			i = 50;			

		_.each(timeline, function(unit){
			var date = new Date(unit.time*1), tab, ampm = date.getHours() < 12 ? 'AM' :'PM',
				hour = date.getHours() > 12 ? date.getHours()-12 : date.getHours(),
				min = (date.getMinutes()+'').length == 1 ? '0'+date.getMinutes() : date.getMinutes(),
				hour = hour == 0 ? 12 : hour; 
				
			tab = (unit.text) ? mainTab(paper.width, i, unit.text):
							    smallTab(paper.width, i, hour+':'+min+' '+ampm);

			tab.click(function(){onClick(unit);});
			i=i+20;
			unit.el = tab;
			return unit;
		});		
	};


})(this.jQuery);




window.log = function(){
  log.history = log.history || [];   
  log.history.push(arguments);
  if(this.console){
    console.log( Array.prototype.slice.call(arguments) );
  }
};
(function(doc){
  var write = doc.write;
  doc.write = function(q){ 
    log('document.write(): ',arguments); 
    if (/docwriteregexwhitelist/.test(q)) write.apply(doc,arguments);  
  };
})(document);


